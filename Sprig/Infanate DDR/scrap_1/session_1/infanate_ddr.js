/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Infanate Dance Dance Revolution
@author: Andrew Cromar
@tags: []
@img: ""
@addedOn: 2024-00-00
*/

const arrow_up = "q"
const arrow_down = "w"
const arrow_left = "e"
const arrow_right = "r"

const arrow_up_empty = "t"
const arrow_down_empty = "y"
const arrow_left_empty = "u"
const arrow_right_empty = "i"

const miss = "o"
const hit = "p"

const background = "a"

setLegend(
  [ arrow_up, bitmap `
.......00.......
......0000......
.....008300.....
....00833300....
...0083333300...
..008333333300..
..000003300000..
......0330......
......0330......
......0330......
......0330......
......0330......
......0330......
......0330......
......0330......
......0000......` ],
  [ arrow_down, bitmap `
......0000......
......04D0......
......04D0......
......04D0......
......04D0......
......04D0......
......04D0......
......04D0......
......04D0......
..000004D00000..
..00444DDDDD00..
...00DDDDDD00...
....00DDDD00....
.....00DD00.....
......0000......
.......00.......` ],
  [ arrow_left, bitmap `
................
................
.....00.........
....000.........
...0060.........
..006F0.........
.006FF0000000000
006FFFFFFFFFFFF0
00FFFFFFFFFFFFF0
.00FFF0000000000
..00FF0.........
...00F0.........
....000.........
.....00.........
................
................` ],
  [ arrow_right, bitmap `
................
................
.........00.....
.........000....
.........0700...
.........07500..
000000000075500.
0777777777555500
0555555555555500
000000000055500.
.........05500..
.........0500...
.........000....
.........00.....
................
................` ],
  [ arrow_up_empty, bitmap `
.......00.......
......0000......
.....001L00.....
....001LLL00....
...001LLLLL00...
..001LLLLLLL00..
..00000LL00000..
......0LL0......
......0LL0......
......0LL0......
......0LL0......
......0LL0......
......0LL0......
......0LL0......
......0LL0......
......0000......` ],
  [ arrow_down_empty, bitmap `
......0000......
......01L0......
......01L0......
......01L0......
......01L0......
......01L0......
......01L0......
......01L0......
......01L0......
..000001L00000..
..00111LLLLL00..
...00LLLLLL00...
....00LLLL00....
.....00LL00.....
......0000......
.......00.......` ],
  [ arrow_left_empty, bitmap `
................
................
.....00.........
....000.........
...0010.........
..001L0.........
.001LL0000000000
001LLLLLLLLLLLL0
00LLLLLLLLLLLLL0
.00LLL0000000000
..00LL0.........
...00L0.........
....000.........
.....00.........
................
................` ],
  [ arrow_right_empty, bitmap `
................
................
.........00.....
.........000....
.........0100...
.........01L00..
00000000001LL00.
0111111111LLLL00
0LLLLLLLLLLLLL00
0000000000LLL00.
.........0LL00..
.........0L00...
.........000....
.........00.....
................
................` ],
  [ miss, bitmap `
................
..00........00..
.0330......0330.
.03330....03330.
..03330..03330..
...0333003330...
....03333330....
.....033330.....
.....033330.....
....03333330....
...0333003330...
..03330..03330..
.03330....03330.
.0330......0330.
..00........00..
................` ],
  [ hit, bitmap `
................
................
................
...........00...
..........0440..
.........04440..
...00...04440...
..0440.04440....
..044404440.....
...0444440......
....04440.......
.....040........
......0.........
................
................
................` ],
  [ background, bitmap `
00001LLLLLL10000
0001LLLLLLLL1000
001LLLLLLLLLL100
01LLLLLLLLLLLL10
1LLLLLLLLLLLLLL1
LLLLLLLLLLLLLLLL
LLLLLLLLLLLLLLLL
LLLLLLLLLLLLLLLL
LLLLLLLLLLLLLLLL
LLLLLLLLLLLLLLLL
LLLLLLLLLLLLLLLL
1LLLLLLLLLLLLLL1
01LLLLLLLLLLLL10
001LLLLLLLLLL100
0001LLLLLLLL1000
00001LLLLLL10000` ]
);

const miss_sound = tune `
500: C4-500,
15500`;
const left_hit_sound = tune `
500: B5^500,
15500`;
const up_hit_sound = tune `
500: A5^500,
15500`;
const down_hit_sound = tune `
500: G5^500,
15500`;
const right_hit_sound = tune `
500: F5^500,
15500`;

const level = map`
....
utyi
....
....
....
....
....
....
....
....`;
setMap(level)

setBackground(background);

const intervalId = setInterval(tick, 500);

function tick() {
  ClearAlearts();
  MoveArrowsUp();
  CheckForMisses();
  LoadNewNotes();
}

onInput("w", () => {
  tilesWith(arrow_up, arrow_up_empty).forEach((spot) => {
    clearTile(spot[0].x, spot[0].y);
    addSprite(spot[0].x, spot[0].y, "t");
    addSprite(spot[0].x, 0, "p");
    playTune(up_hit_sound);
  });
});

onInput("s", () => {
    tilesWith(arrow_down, arrow_down_empty).forEach((spot) => {
    clearTile(spot[0].x, spot[0].y);
    addSprite(spot[0].x, spot[0].y, "y");
    addSprite(spot[0].x, 0, "p");
    playTune(down_hit_sound);
  });
});

onInput("a", () => {
    tilesWith(arrow_left, arrow_left_empty).forEach((spot) => {
    clearTile(spot[0].x, spot[0].y);
    addSprite(spot[0].x, spot[0].y, "u");
    addSprite(spot[0].x, 0, "p");
    playTune(left_hit_sound);
  });
});

onInput("d", () => {
    tilesWith(arrow_right, arrow_right_empty).forEach((spot) => {
    clearTile(spot[0].x, spot[0].y);
    addSprite(spot[0].x, spot[0].y, "i");
    addSprite(spot[0].x, 0, "p");
    playTune(right_hit_sound);
  });
});

onInput("j", () => { clearInterval(intervalId); });
 
function MoveArrowsUp(){
  const arrows = tilesWith(arrow_up).concat(tilesWith(arrow_down)).concat(tilesWith(arrow_left)).concat(tilesWith(arrow_right));
  arrows.forEach((arrow) => { arrow[0].y -= 1; });
}

function CheckForMisses(){  
  const arrows = tilesWith(arrow_up).concat(tilesWith(arrow_down)).concat(tilesWith(arrow_left)).concat(tilesWith(arrow_right));

  arrows.forEach((arrow) => {
    var x = arrow[0].x;
    var y = arrow[0].y;

    if(y == 0){
      clearTile(x, y);
      addSprite(x, y, "o");
      playTune(miss_sound);
    }
  });
}

function ClearAlearts(){
  tilesWith(miss).forEach((miss) => clearTile(miss[0].x, miss[0].y));
  tilesWith(hit).forEach((hit) => clearTile(hit[0].x, hit[0].y));
}

function LoadNewNotes(){
  for (let i = 0; i < Math.floor(Math.random() * 3); i++) {
    const y = height() - 1;
    switch (Math.floor(Math.random() * 4)){
      case 0:
        addSprite(1, y, "q");
        break;
      case 1:
        addSprite(2, y, "w");
        break;
      case 2:
        addSprite(0, y, "e");
        break;
      case 3:
        addSprite(3, y, "r");
        break;
    }
  }
}




